clear; close; clc;
% ROS Setup
rosinit;
j1_effort = rospublisher('/fridge_bot/joint1_effort_controller/command');
j3_effort = rospublisher('/fridge_bot/joint3_effort_controller/command');
j7_effort = rospublisher('/fridge_bot/joint7_effort_controller/command');

JointStates = rossubscriber('/fridge_bot/joint_states');
tau1 = rosmessage(j1_effort);
tau3 = rosmessage(j3_effort);
tau7 = rosmessage(j7_effort);
tau1.Data = 0;
tau3.Data = 0;
tau7.Data = 0;
send(j1_effort,tau1);
send(j3_effort,tau3);
send(j7_effort,tau7);
client = rossvcclient('/gazebo/set_model_configuration');
req = rosmessage(client);
req.ModelName = 'fridge_bot';
req.UrdfParamName = 'robot_description';
req.JointNames = {'joint1','joint3','joint7'};
req.JointPositions = [deg2rad(0), deg2rad(0),deg2rad(0)];
resp = call(client,req,'Timeout',3);
tic;
t1 = 0;

z1 = [];
z2 = [];
z3 = [];
z4 = [];
z5 = [];
z6 = [];
torq1 = [];
torq2 = [];
torq3 = [];
T = [];
syms t;
traj1 = (pi*(- (3*t^3)/25 + (9*t^2)/5))/180;
traj2 = (pi*(- (9*t^3)/50 + (27*t^2)/10))/180;
traj3 = (pi*(- (9*t^3)/50 + (27*t^2)/10))/180;

traj1dot = diff(traj1,t);
traj2dot = diff(traj2,t);
traj3dot = diff(traj3,t);

traj1ddot = diff(traj1dot,t);
traj2ddot = diff(traj2dot,t);
traj3ddot = diff(traj3dot,t);

trajddot = [traj1ddot;traj2ddot;traj3ddot];



while(t1 < 60)
t1 = toc;
% read the joint states
jointData = receive(JointStates);
% inspect the "jointData" variable in MATLAB to get familiar with its structure
Z = [jointData.Position(1);jointData.Position(2);jointData.Position(3);jointData.Velocity(1);jointData.Velocity(2);jointData.Velocity(3)];

q1 = Z(1);
q2 = Z(2);
q3 = Z(3);
q_dot_1 = Z(4);
q_dot_2 = Z(5);
q_dot_3 = Z(6);
theta_dots = [q_dot_1, q_dot_2, q_dot_3];


% K = [12.0000         0         0    7.0000         0         0;
%          0    2.0000         0         0    3.0000         0;
%          0         0    2.0000         0         0    3.0000];



K = [0.3000         0         0    1.3000         0         0;
         0    0.0600         0         0    0.5000         0;
         0         0    0.2000         0         0    1.2000];


% I1 = 0; I2 = 0; I3 = 0; l1R = 31.85; l1D = 25; l2R = 200; l2D = 0; l3R = 200; l3D = 0;
% lc1R = -6.37; lc1D = 14.26; lc2R = 110.86; lc2D = 4.06; lc3R = 122.2; lc3D = 31; 
% m1 = 0.1923; m2 = 0.08557; m3 = 0.09533;
syms m1 m2 m3 real
% syms q1 q2 q3 real
syms g real
% syms q_dot_1 q_dot_2 q_dot_3 q_ddot_1 q_ddot_2 q_ddot_3 real
% syms m1 m2 m3 g
 
D = [                                                                                                                                                                                                                                                                                                                                                                                                                               (625*m1)/4 + (37012411*m2)/5000 + (880834349*m3)/20000 - (6581749661260841*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 + (916863998870159*cos(2*q2 + 4867473934616897/2251799813685248))/4294967296 - (5226626104290181*sin(2*q2 + 4867473934616897/2251799813685248))/137438953472 - (18355633961796893*cos(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 + (7799001*m2*cos(q2 + 4867473934616897/4503599627370496))/2500 + 5628*m3*cos(q2 + 4867473934616897/4503599627370496) + (26733*m2*sin(q2 + 4867473934616897/4503599627370496))/100 + (2109093*m3*cos(q3 - q2 + 4773815605012725/4503599627370496))/5000 + (3812403*m2*cos(2*q2 + 4867473934616897/2251799813685248))/625 + 20000*m3*cos(2*q2 + 4867473934616897/2251799813685248) + (105317*m2*sin(2*q2 + 4867473934616897/2251799813685248))/100 + (2247001*m3*cos(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/20000 + 2998*m3*cos(2*q2 - q3 + 23414582401043/1125899906842624) + 2998*m3*cos(q3 + 4820644769814811/2251799813685248) + 38026358627269343/4294967296,                                                                                                                                                                                                                                               (3530891*m2*sin(q2 + 4867473934616897/4503599627370496))/1000 - (12103*m2*cos(q2 + 4867473934616897/4503599627370496))/40 + 30810*m3*sin(q2 + 4867473934616897/4503599627370496) - (380248726742978697197519224480730^(1/2)*cos(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/8589934592 - (47*51579247214256630050556999433^(1/2)*cos(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (4618419*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/2000 - (888132563076406772200279514740505^(1/2)*cos(q1 + 2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/274877906944 + (11*8516287168658379997203140404841^(1/2)*cos(q1 + q2 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 - (47*51579247214256630050556999433^(1/2)*cos(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (888132563076406772200279514740505^(1/2)*cos(2*q2 - q1 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/274877906944 + (380248726742978697197519224480730^(1/2)*cos(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 + (11*8516287168658379997203140404841^(1/2)*cos(q2 - q1 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736,                                                                                                                                                                                                                                                  (4618419*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/2000 - (47*51579247214256630050556999433^(1/2)*cos(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (380248726742978697197519224480730^(1/2)*cos(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/8589934592 - (47*51579247214256630050556999433^(1/2)*cos(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (380248726742978697197519224480730^(1/2)*cos(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592;
(3530891*m2*sin(q2 + 4867473934616897/4503599627370496))/1000 - (12103*m2*cos(q2 + 4867473934616897/4503599627370496))/40 + 30810*m3*sin(q2 + 4867473934616897/4503599627370496) - (380248726742978697197519224480730^(1/2)*cos(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/8589934592 - (47*51579247214256630050556999433^(1/2)*cos(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (4618419*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/2000 - (888132563076406772200279514740505^(1/2)*cos(q1 + 2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/274877906944 + (11*8516287168658379997203140404841^(1/2)*cos(q1 + q2 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 - (47*51579247214256630050556999433^(1/2)*cos(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (888132563076406772200279514740505^(1/2)*cos(2*q2 - q1 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/274877906944 + (380248726742978697197519224480730^(1/2)*cos(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 + (11*8516287168658379997203140404841^(1/2)*cos(q2 - q1 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736, (15475237*m2)/1250 + (402247001*m3)/10000 + (1492406782981571*cos(2*q1))/1073741824 - (888132563076406772200279514740505^(1/2)*cos(2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/274877906944 - (380248726742978697197519224480730^(1/2)*cos(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (380248726742978697197519224480730^(1/2)*cos(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*cos(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*cos(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*cos(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (888132563076406772200279514740505^(1/2)*cos(2*q2 - 2*q1 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 + (888132563076406772200279514740505^(1/2)*cos(2*q1 + 2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 + 5996*m3*cos(q3 + 4820644769814811/2251799813685248) + (11*8516287168658379997203140404841^(1/2)*cos(q2 - 2*q1 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 - (11*8516287168658379997203140404841^(1/2)*cos(2*q1 + q2 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 + 20067704181568307/2147483648, (21072377729169493*cos(2*q1))/8589934592 - (2247001*m3)/10000 - (380248726742978697197519224480730^(1/2)*cos(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (380248726742978697197519224480730^(1/2)*cos(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*cos(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*cos(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*cos(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - 2998*m3*cos(q3 + 4820644769814811/2251799813685248) + 67390063540457963/8589934592;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       (4618419*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/2000 - (47*51579247214256630050556999433^(1/2)*cos(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (380248726742978697197519224480730^(1/2)*cos(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/8589934592 - (47*51579247214256630050556999433^(1/2)*cos(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (380248726742978697197519224480730^(1/2)*cos(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     (21072377729169493*cos(2*q1))/8589934592 - (2247001*m3)/10000 - (380248726742978697197519224480730^(1/2)*cos(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (380248726742978697197519224480730^(1/2)*cos(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*cos(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*cos(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*cos(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - 2998*m3*cos(q3 + 4820644769814811/2251799813685248) + 67390063540457963/8589934592,                                                       (2247001*m3)/10000 + (21072377729169493*cos(2*q1))/8589934592 - (380248726742978697197519224480730^(1/2)*cos(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (380248726742978697197519224480730^(1/2)*cos(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*cos(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*cos(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*cos(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + 67390063540457963/8589934592];


C = [                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     - q_dot_2*((18355633961796893*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 + (5226626104290181*cos(2*q2 + 4867473934616897/2251799813685248))/137438953472 + (916863998870159*sin(2*q2 + 4867473934616897/2251799813685248))/4294967296 - (6581749661260841*cos(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 - (26733*m2*cos(q2 + 4867473934616897/4503599627370496))/200 + (7799001*m2*sin(q2 + 4867473934616897/4503599627370496))/5000 + 2814*m3*sin(q2 + 4867473934616897/4503599627370496) - (2109093*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/10000 - (105317*m2*cos(2*q2 + 4867473934616897/2251799813685248))/100 + (3812403*m2*sin(2*q2 + 4867473934616897/2251799813685248))/625 + 20000*m3*sin(2*q2 + 4867473934616897/2251799813685248) - (2247001*m3*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/20000 + 2998*m3*sin(2*q2 - q3 + 23414582401043/1125899906842624)) - q_dot_3*((6581749661260841*cos(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 - (18355633961796893*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 + (2109093*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/10000 + (2247001*m3*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/20000 - 1499*m3*sin(2*q2 - q3 + 23414582401043/1125899906842624) + 1499*m3*sin(q3 + 4820644769814811/2251799813685248)), - q_dot_3*((380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (21072377729169493*sin(2*q1))/8589934592 + (4618419*m3*cos(q3 - q2 + 4773815605012725/4503599627370496))/2000 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184) - q_dot_2*((380248726742978697197519224480730^(1/2)*sin(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/4294967296 - (3530891*m2*cos(q2 + 4867473934616897/4503599627370496))/1000 - 30810*m3*cos(q2 + 4867473934616897/4503599627370496) - (12103*m2*sin(q2 + 4867473934616897/4503599627370496))/40 - (1492406782981571*sin(2*q1))/1073741824 + (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (4618419*m3*cos(q3 - q2 + 4773815605012725/4503599627370496))/2000 + (47*51579247214256630050556999433^(1/2)*sin(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (888132563076406772200279514740505^(1/2)*sin(q1 + 2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/137438953472 + (11*8516287168658379997203140404841^(1/2)*sin(q1 + q2 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (888132563076406772200279514740505^(1/2)*sin(2*q2 - q1 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/137438953472 + (888132563076406772200279514740505^(1/2)*sin(2*q2 - 2*q1 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 - (888132563076406772200279514740505^(1/2)*sin(2*q1 + 2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 + (380248726742978697197519224480730^(1/2)*sin(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/4294967296 + (11*8516287168658379997203140404841^(1/2)*sin(q2 - q1 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 + (11*8516287168658379997203140404841^(1/2)*sin(q2 - 2*q1 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 + (11*8516287168658379997203140404841^(1/2)*sin(2*q1 + q2 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736) - q_dot_1*((18355633961796893*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 + (5226626104290181*cos(2*q2 + 4867473934616897/2251799813685248))/137438953472 + (916863998870159*sin(2*q2 + 4867473934616897/2251799813685248))/4294967296 - (6581749661260841*cos(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 - (26733*m2*cos(q2 + 4867473934616897/4503599627370496))/200 + (7799001*m2*sin(q2 + 4867473934616897/4503599627370496))/5000 + 2814*m3*sin(q2 + 4867473934616897/4503599627370496) - (2109093*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/10000 - (105317*m2*cos(2*q2 + 4867473934616897/2251799813685248))/100 + (3812403*m2*sin(2*q2 + 4867473934616897/2251799813685248))/625 + 20000*m3*sin(2*q2 + 4867473934616897/2251799813685248) - (2247001*m3*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/20000 + 2998*m3*sin(2*q2 - q3 + 23414582401043/1125899906842624)),                                                                                                                                                                                                                                                                                                                                                                                                                                            q_dot_3*((21072377729169493*sin(2*q1))/8589934592 + (380248726742978697197519224480730^(1/2)*sin(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/4294967296 - (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (4618419*m3*cos(q3 - q2 + 4773815605012725/4503599627370496))/2000 + (47*51579247214256630050556999433^(1/2)*sin(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/4294967296) - q_dot_2*((380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (21072377729169493*sin(2*q1))/8589934592 + (4618419*m3*cos(q3 - q2 + 4773815605012725/4503599627370496))/2000 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184) - q_dot_1*((6581749661260841*cos(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 - (18355633961796893*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 + (2109093*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/10000 + (2247001*m3*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/20000 - 1499*m3*sin(2*q2 - q3 + 23414582401043/1125899906842624) + 1499*m3*sin(q3 + 4820644769814811/2251799813685248));
q_dot_3*((380248726742978697197519224480730^(1/2)*sin(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/4294967296 - (21072377729169493*sin(2*q1))/8589934592 + (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/4294967296) + q_dot_1*((18355633961796893*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 + (5226626104290181*cos(2*q2 + 4867473934616897/2251799813685248))/137438953472 + (916863998870159*sin(2*q2 + 4867473934616897/2251799813685248))/4294967296 - (6581749661260841*cos(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 - (26733*m2*cos(q2 + 4867473934616897/4503599627370496))/200 + (7799001*m2*sin(q2 + 4867473934616897/4503599627370496))/5000 + 2814*m3*sin(q2 + 4867473934616897/4503599627370496) + (380248726742978697197519224480730^(1/2)*sin(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/8589934592 - (2109093*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/10000 - (105317*m2*cos(2*q2 + 4867473934616897/2251799813685248))/100 + (47*51579247214256630050556999433^(1/2)*sin(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (888132563076406772200279514740505^(1/2)*sin(q1 + 2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/274877906944 + (3812403*m2*sin(2*q2 + 4867473934616897/2251799813685248))/625 + 20000*m3*sin(2*q2 + 4867473934616897/2251799813685248) - (11*8516287168658379997203140404841^(1/2)*sin(q1 + q2 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 - (2247001*m3*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/20000 - (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (888132563076406772200279514740505^(1/2)*sin(2*q2 - q1 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/274877906944 + 2998*m3*sin(2*q2 - q3 + 23414582401043/1125899906842624) - (380248726742978697197519224480730^(1/2)*sin(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 + (11*8516287168658379997203140404841^(1/2)*sin(q2 - q1 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736) + q_dot_2*((380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (1492406782981571*sin(2*q1))/1073741824 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (888132563076406772200279514740505^(1/2)*sin(2*q2 - 2*q1 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 - (888132563076406772200279514740505^(1/2)*sin(2*q1 + 2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 + (11*8516287168658379997203140404841^(1/2)*sin(q2 - 2*q1 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 + (11*8516287168658379997203140404841^(1/2)*sin(2*q1 + q2 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 q_dot_1*((380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (1492406782981571*sin(2*q1))/1073741824 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (888132563076406772200279514740505^(1/2)*sin(2*q2 - 2*q1 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 - (888132563076406772200279514740505^(1/2)*sin(2*q1 + 2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 + (11*8516287168658379997203140404841^(1/2)*sin(q2 - 2*q1 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736 + (11*8516287168658379997203140404841^(1/2)*sin(2*q1 + q2 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/68719476736) - q_dot_3*((380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (380248726742978697197519224480730^(1/2)*sin(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 - (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + 2998*m3*sin(q3 + 4820644769814811/2251799813685248)) - q_dot_2*((380248726742978697197519224480730^(1/2)*sin(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (888132563076406772200279514740505^(1/2)*sin(2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/274877906944 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + (888132563076406772200279514740505^(1/2)*sin(2*q2 - 2*q1 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 + (888132563076406772200279514740505^(1/2)*sin(2*q1 + 2*q2 + atan(5226626104290181/29339647963845088) + 4867473934616897/2251799813685248))/549755813888 + (11*8516287168658379997203140404841^(1/2)*sin(q2 - 2*q1 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/137438953472 - (11*8516287168658379997203140404841^(1/2)*sin(2*q1 + q2 + atan(2905140461845396/276488816423195) + 4867473934616897/4503599627370496))/137438953472), q_dot_3*((3*380248726742978697197519224480730^(1/2)*sin(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (3*380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (3*380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 - (141*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + (141*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + 2998*m3*sin(q3 + 4820644769814811/2251799813685248)) - q_dot_2*((380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (380248726742978697197519224480730^(1/2)*sin(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 - (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + 2998*m3*sin(q3 + 4820644769814811/2251799813685248)) + q_dot_1*((380248726742978697197519224480730^(1/2)*sin(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/4294967296 - (21072377729169493*sin(2*q1))/8589934592 + (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/4294967296);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   q_dot_1*((6581749661260841*cos(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 - (18355633961796893*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/4294967296 + (380248726742978697197519224480730^(1/2)*sin(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/8589934592 + (2109093*m3*sin(q3 - q2 + 4773815605012725/4503599627370496))/10000 + (47*51579247214256630050556999433^(1/2)*sin(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (2247001*m3*sin(2*q3 - 2*q2 + 4773815605012725/2251799813685248))/20000 - (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - 1499*m3*sin(2*q2 - q3 + 23414582401043/1125899906842624) + 1499*m3*sin(q3 + 4820644769814811/2251799813685248) - (380248726742978697197519224480730^(1/2)*sin(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592) - q_dot_2*((21072377729169493*sin(2*q1))/8589934592 + (380248726742978697197519224480730^(1/2)*sin(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/4294967296 - (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/4294967296) + q_dot_3*((380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (21072377729169493*sin(2*q1))/8589934592 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    q_dot_2*((3*380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (3*380248726742978697197519224480730^(1/2)*sin(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (3*380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (141*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 - (141*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + 2998*m3*sin(q3 + 4820644769814811/2251799813685248)) - q_dot_1*((21072377729169493*sin(2*q1))/8589934592 + (380248726742978697197519224480730^(1/2)*sin(q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/4294967296 - (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/4294967296) - q_dot_3*((380248726742978697197519224480730^(1/2)*sin(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     q_dot_3*((380248726742978697197519224480730^(1/2)*sin(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368) - q_dot_2*((380248726742978697197519224480730^(1/2)*sin(2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/8589934592 - (380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 - (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/34359738368) + q_dot_1*((380248726742978697197519224480730^(1/2)*sin(2*q1 + 2*q2 - 2*q3 + atan(6581749661260841/18355633961796893) - 4773815605012725/2251799813685248))/17179869184 - (21072377729169493*sin(2*q1))/8589934592 + (380248726742978697197519224480730^(1/2)*sin(2*q1 - 2*q2 + 2*q3 - atan(6581749661260841/18355633961796893) + 4773815605012725/2251799813685248))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(q3 - q2 - 2*q1 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184 + (47*51579247214256630050556999433^(1/2)*sin(2*q1 - q2 + q3 + atan(33917565088117/224563679148588) + 4773815605012725/4503599627370496))/17179869184)];
 

G = [0;g*m3*(200*cos(q2 + 4867473934616897/4503599627370496) + (1499*cos(q3 + 4820644769814811/2251799813685248)*cos(q2 + 4867473934616897/4503599627370496))/100 + (1499*sin(q3 + 4820644769814811/2251799813685248)*sin(q2 + 4867473934616897/4503599627370496))/100) + g*m2*((5543*cos(q2 + 4867473934616897/4503599627370496))/50 + (19*sin(q2 + 4867473934616897/4503599627370496))/2);-g*m3*((1499*cos(q3 + 4820644769814811/2251799813685248)*cos(q2 + 4867473934616897/4503599627370496))/100 + (1499*sin(q3 + 4820644769814811/2251799813685248)*sin(q2 + 4867473934616897/4503599627370496))/100)];
 
M = double(subs(D,[g,m1,m2,m3],[9.8,125.62,79.99,429.4837]));
C = double(subs(C,[g,m1,m2,m3],[9.8,125.62,79.99,429.4837]));
G = double(subs(G,[g,m1,m2,m3],[9.8,125.62,79.99,429.4837]));

% traj1 = subs(traj1,t,t1); 
% traj2 = subs(traj2,t,t1); 
% traj3 = subs(traj3,t,t1);
% traj1dot = subs(traj1dot,t,t1); traj2dot = subs(traj2dot,t,t1);  traj3dot = subs(traj3dot,t,t1); trajddot = subs(trajddot,t,t1);
error = [wrapToPi(Z(1)-0);wrapToPi(Z(2)-0.49);wrapToPi(Z(3)+0.57); Z(4);Z(5);Z(6)]
t1
v = (-1*K*error);



Tau = double((M*v + C*theta_dots' +G)*0.0000098);

u1 = double(Tau(1))
u3 = double(Tau(2))
u7 = double(Tau(3))

torq1 = [torq1;u1];
torq2 = [torq2;u3];
torq3 = [torq3;u7];
T = [T;toc];
z1 = [z1;Z(1)];
z2 = [z2;Z(2)];
z3 = [z3;Z(3)];
z4 = [z4;Z(4)];
z5 = [z5;Z(5)];
z6 = [z6;Z(6)];
% design your state feedback controller in the following
tau1.Data = u1;
tau3.Data = u3;
tau7.Data = u7;
send(j1_effort,tau1);
send(j3_effort,tau3);
send(j7_effort,tau7);
% you can sample data here to be plotted at the end
end
tau1.Data = 0;
tau3.Data = 0;
tau7.Data = 0;
send(j1_effort,tau1);
send(j3_effort,tau3);
send(j7_effort,tau7);
% disconnect from roscore
rosshutdown;

subplot(3,3,1);
plot(T,z1)
xlabel("time")
ylabel("radians")
title("theta1")


subplot(3,3,2);
plot(T,z2)
xlabel("time")
ylabel("radians")
title("theta2")

subplot(3,3,3);
plot(T,z3)
xlabel("time")
ylabel("rad/s")
title("theta3")

subplot(3,3,4);
plot(T,z4)
xlabel("time")
ylabel("rad/s")
title("theta1_dot")

subplot(3,3,5);
plot(T,z5)
xlabel("time")
ylabel("rad/s")
title("theta2_dot")

subplot(3,3,6);
plot(T,z6)
xlabel("time")
ylabel("rad/s")
title("theta3_dot")

subplot(3,3,7);
plot(T,torq1)
xlabel("time")
ylabel("N/m")
title("u1")

subplot(3,3,8);
plot(T,torq2)
xlabel("time")
ylabel("N/m")
title("u2")

subplot(3,3,9);
plot(T,torq3)
xlabel("time")
ylabel("N/m")
title("u3")

function T = ModifyedDHparam2matrix(theta, ai_1, di, alpha)
    a = [cos(theta), -sin(theta), 0, ai_1];
    b = [sin(theta)*cos(alpha), cos(theta)*cos(alpha), -sin(alpha), -di*sin(alpha)];
    c = [sin(theta)*sin(alpha), cos(theta)*sin(alpha), cos(alpha), di*cos(alpha)];
    d = [0, 0, 0, 1];
    T = [a;b;c;d];
end
